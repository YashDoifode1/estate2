{% extends 'base.html' %}

{% block title %}{{ property.title }} | DreamHomes Realty{% endblock %}

{% block content %}
    <!-- Breadcrumb -->
    <section class="bg-gray-100 py-4">
        <div class="container mx-auto px-4">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2 text-sm">
                    <li>
                        <a href="{% url 'home' %}" class="text-gray-500 hover:text-blue-900 transition">Home</a>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="{% url 'properties' %}" class="text-gray-500 hover:text-blue-900 transition">Properties</a>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <span class="text-blue-900 font-medium">{{ property.title }}</span>
                    </li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Property Details -->
            <div class="lg:w-2/3">
                <!-- Back to Listings Button -->
                <div class="mb-6">
                    <a href="{% url 'properties' %}" class="inline-flex items-center text-blue-900 hover:text-yellow-600 transition font-medium">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Listings
                    </a>
                </div>
                
                <!-- Image Gallery -->
                <div class="mb-8">
                    <div class="swiper mySwiper">
                        <div class="swiper-wrapper">
                            {% for image in property.images.all %}
                                <div class="swiper-slide">
                                    <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:property.title }}" />
                                </div>
                            {% empty %}
                                <div class="swiper-slide">
                                    <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" 
                                         alt="{{ property.title }}" />
                                </div>
                            {% endfor %}
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-pagination"></div>
                    </div>
                </div>
                
                <!-- Property Title & Price -->
                <div class="mb-8">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-start">
                        <div>
                            <span class="inline-block bg-{% if property.status == 'for_sale' %}yellow{% else %}green{% endif %}-600 text-white px-3 py-1 rounded-full text-sm font-semibold mb-2">
                                {{ property.get_status_display }}
                            </span>
                            <h1 class="text-3xl font-bold text-blue-900 mb-2">{{ property.title }}</h1>
                            <p class="text-gray-600 flex items-center">
                                <i class="fas fa-map-marker-alt text-yellow-600 mr-2"></i> {{ property.location }}
                            </p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <p class="text-3xl font-bold text-blue-900">{{ property.price }}</p>
                            {% if property.price_per_sqft %}
                                <p class="text-gray-600 text-right">{{ property.price_per_sqft }}/sq.ft.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Property Highlights -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-bold text-blue-900 mb-4">Property Highlights</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-bed text-blue-900 text-xl"></i>
                            </div>
                            <p class="font-semibold">{{ property.bedrooms }} Bedrooms</p>
                        </div>
                        <div class="text-center">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-bath text-blue-900 text-xl"></i>
                            </div>
                            <p class="font-semibold">{{ property.bathrooms }} Bathrooms</p>
                        </div>
                        <div class="text-center">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-vector-square text-blue-900 text-xl"></i>
                            </div>
                            <p class="font-semibold">{{ property.total_area }} sq.ft.</p>
                        </div>
                        <div class="text-center">
                            <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-building text-blue-900 text-xl"></i>
                            </div>
                            <p class="font-semibold">{{ property.get_type_display }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Property Description -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-bold text-blue-900 mb-4">Property Description</h2>
                    {% for paragraph in property.description|split:"\n" %}
                        {% if paragraph.strip %}
                            <p class="text-gray-700 mb-4">{{ paragraph }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <!-- Amenities -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-bold text-blue-900 mb-4">Amenities</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for amenity in property.amenities.all %}
                            <div class="flex items-center">
                                <div class="amenity-icon">
                                    <i class="{{ amenity.icon_class }}"></i>
                                </div>
                                <span>{{ amenity.name }}</span>
                            </div>
                        {% empty %}
                            <p class="text-gray-600">No amenities listed.</p>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Property Details -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-bold text-blue-900 mb-4">Property Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Property ID</span>
                            <span class="font-semibold">{{ property.property_id }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Property Type</span>
                            <span class="font-semibold">{{ property.get_type_display }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Property Status</span>
                            <span class="font-semibold">{{ property.get_status_display }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Year Built</span>
                            <span class="font-semibold">{{ property.year_built }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Total Area</span>
                            <span class="font-semibold">{{ property.total_area }} sq.ft.</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Bedrooms</span>
                            <span class="font-semibold">{{ property.bedrooms }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Bathrooms</span>
                            <span class="font-semibold">{{ property.bathrooms }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Garage</span>
                            <span class="font-semibold">{{ property.garage }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Floor</span>
                            <span class="font-semibold">{{ property.floor }}</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-gray-200">
                            <span class="text-gray-600">Furnishing</span>
                            <span class="font-semibold">{{ property.furnishing }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Location & Map -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-bold text-blue-900 mb-4">Location</h2>
                    <p class="text-gray-700 mb-4">{{ property.location_description }}</p>
                    
                    <!-- Map Embed Placeholder -->
                    <div class="bg-gray-200 h-64 rounded-lg flex items-center justify-center mb-4">
                        <div class="text-center">
                            <i class="fas fa-map-marked-alt text-4xl text-blue-900 mb-2"></i>
                            <p class="text-gray-700">Interactive Map</p>
                            <p class="text-gray-500 text-sm">{{ property.location }}</p>
                        </div>
                    </div>
                    
                    <!-- Nearby Places -->
                    <h3 class="text-lg font-semibold text-blue-900 mb-3">Nearby Places</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for place in property.nearby_places.all %}
                            <div class="flex items-center">
                                <i class="{{ place.icon_class }} text-yellow-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">{{ place.name }}</p>
                                    <p class="text-gray-600 text-sm">{{ place.distance }} away</p>
                                </div>
                            </div>
                        {% empty %}
                            <p class="text-gray-600">No nearby places listed.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="lg:w-1/3">
                <div class="sticky-sidebar">
                    <!-- Contact Form -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h2 class="text-xl font-bold text-blue-900 mb-4">Schedule a Visit</h2>
                        <p class="text-gray-600 mb-4">Interested in this property? Fill out the form below and our agent will contact you shortly.</p>
                        
                        <form class="contact-form" id="schedule-visit-form" method="POST" action="{% url 'schedule_visit' property.id %}">
                            {% csrf_token %}
                            {{ form.name }}
                            {{ form.email }}
                            {{ form.phone }}
                            {{ form.preferred_date }}
                            {{ form.preferred_time }}
                            {{ form.message }}
                            <button type="submit" class="w-full bg-blue-900 hover:bg-blue-800 text-white font-bold py-3 rounded-lg transition">
                                Schedule Visit
                            </button>
                            <p id="form-error" class="text-red-500 text-sm mt-1 {% if not form.errors %}hidden{% endif %}">
                                {{ form.errors|first|default:"Please correct the errors above" }}
                            </p>
                        </form>
                    </div>
                    
                    <!-- Contact Agent -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h2 class="text-xl font-bold text-blue-900 mb-4">Contact Agent</h2>
                        <div class="flex items-center mb-4">
                            <img src="{{ property.agent.profile_image.url|default:'https://randomuser.me/api/portraits/men/45.jpg' }}" 
                                 alt="{{ property.agent.name }}" class="w-16 h-16 rounded-full mr-4">
                            <div>
                                <h3 class="font-bold text-blue-900">{{ property.agent.name }}</h3>
                                <p class="text-gray-600">{{ property.agent.title }}</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <i class="fas fa-phone text-yellow-600 mr-3"></i>
                                <span>{{ property.agent.phone }}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-envelope text-yellow-600 mr-3"></i>
                                <span>{{ property.agent.email }}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-clock text-yellow-600 mr-3"></i>
                                <span>{{ property.agent.hours }}</span>
                            </div>
                        </div>
                        <a href="{% url 'chat_with_agent' property.agent.id %}" class="w-full mt-4 block bg-transparent border-2 border-blue-900 text-blue-900 hover:bg-blue-900 hover:text-white font-bold py-2 rounded-lg transition text-center">
                            <i class="fas fa-comment-dots mr-2"></i> Chat with Agent
                        </a>
                    </div>
                    
                    <!-- Similar Properties -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold text-blue-900 mb-4">Similar Properties</h2>
                        <div class="space-y-4">
                            {% for similar_property in similar_properties %}
                                <div class="flex border rounded-lg overflow-hidden">
                                    <img src="{{ similar_property.image.url|default:'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80' }}" 
                                         alt="{{ similar_property.title }}" class="w-24 h-24 object-cover">
                                    <div class="p-3">
                                        <h3 class="font-bold text-blue-900 text-sm">{{ similar_property.title }}</h3>
                                        <p class="text-gray-600 text-sm mb-1">{{ similar_property.price }}</p>
                                        <a href="{% url 'property_detail' similar_property.id %}" 
                                           class="text-blue-900 text-sm font-medium hover:text-yellow-600 transition">View Details</a>
                                    </div>
                                </div>
                            {% empty %}
                                <p class="text-gray-600">No similar properties found.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- CTA Section -->
    <section class="py-16 bg-blue-900 text-white mt-12">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Interested in This Property?</h2>
            <p class="text-xl mb-10 max-w-2xl mx-auto">
                Contact our agent today to schedule a viewing or get more information.
            </p>
            <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
                <a href="tel:{{ property.agent.phone }}" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-8 rounded-lg transition">
                    <i class="fas fa-phone mr-2"></i> Call Now
                </a>
                <a href="mailto:{{ property.agent.email }}" class="bg-transparent border-2 border-white hover:bg-white hover:text-blue-900 text-white font-bold py-3 px-8 rounded-lg transition">
                    <i class="fas fa-envelope mr-2"></i> Email Agent
                </a>
            </div>
        </div>
    </section>

   

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Initialize Swiper
        const swiper = new Swiper('.mySwiper', {
            spaceBetween: 30,
            effect: 'fade',
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
        });
        
        // Schedule visit form submission
        document.getElementById('schedule-visit-form').addEventListener('submit', function(e) {
            // Let Django handle form submission
            const formError = document.getElementById('form-error');
            if (!formError.classList.contains('hidden')) {
                e.preventDefault();
                formError.classList.remove('hidden');
            } else {
                // Show success message (server will handle actual submission)
                alert('Thank you for your interest! Our agent will contact you shortly to schedule your visit.');
            }
        });
    </script>
{% endblock %}