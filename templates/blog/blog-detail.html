{% extends 'base.html' %}

{% block title %}
{{ post.title }} | DreamHomes Realty Blog
{% endblock %}

{% block content %}
    <!-- Breadcrumb -->
    <section class="bg-gray-100 py-4">
        <div class="container mx-auto px-4">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2 text-sm">
                    <li>
                        <a href="{% url 'home' %}" class="text-gray-500 hover:text-blue-900 transition">Home</a>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <a href="{% url 'blog:blog_list' %}" class="text-gray-500 hover:text-blue-900 transition">Blog</a>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                        <span class="text-blue-900 font-medium">{{ post.title|truncatewords:5 }}</span>
                    </li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Blog Content -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Article Content -->
                <article class="lg:w-2/3">
                    <!-- Article Header -->
                    <header class="mb-8">
                        {% for category in post.categories.all %}
                            <span class="category-badge {{ category.slug }}">{{ category.name }}</span>
                        {% endfor %}
                        
                        <h1 class="text-3xl md:text-4xl font-bold text-blue-900 mt-4 mb-4" data-aos="fade-up">
                            {{ post.title }}
                        </h1>
                        
                        <div class="flex flex-wrap items-center text-gray-600 mb-6" data-aos="fade-up" data-aos-delay="100">
                            <div class="flex items-center mr-6 mb-2">
                                <i class="far fa-calendar-alt mr-2"></i>
                                <span>{{ post.published_date|date:"F d, Y" }}</span>
                            </div>
                            <div class="flex items-center mr-6 mb-2">
                                <i class="far fa-clock mr-2"></i>
                                <span class="reading-time">{{ post.read_time }} min read</span>
                            </div>
                            <div class="flex items-center mb-2">
                                <i class="far fa-user mr-2"></i>
                                <span>By {{ post.author.get_full_name|default:post.author.username }}</span>
                            </div>
                        </div>
                        
                        <!-- Featured Image -->
                        <div class="mb-8" data-aos="fade-up" data-aos-delay="200">
                            {% if post.image and post.image.url %}
                                <img src="{{ post.image.url }}" 
                                     alt="{{ post.title }}" class="w-full h-96 object-cover rounded-lg">
                            {% else %}
                                <div class="w-full h-96 bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center rounded-lg">
                                    <i class="fas fa-home text-white text-6xl"></i>
                                </div>
                            {% endif %}
                        </div>
                    </header>
                    
                    <!-- Article Content -->
                    <div class="article-content prose prose-lg max-w-none" data-aos="fade-up">
                        {{ post.content|safe }}
                    </div>
                    
                    <!-- Article Footer -->
                    <footer class="mt-12 pt-8 border-t border-gray-200">
                        <!-- Tags -->
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-blue-900 mb-3">Tags</h3>
                            <div class="flex flex-wrap gap-2">
                                {% for tag in post.tags.all %}
                                    <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">{{ tag.name }}</span>
                                {% empty %}
                                    <span class="text-gray-500">No tags</span>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Social Sharing -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-blue-900 mb-3">Share This Article</h3>
                            <div class="flex space-x-4">
                                <a href="#" class="social-share facebook-bg text-white w-10 h-10 rounded-full flex items-center justify-center hover:opacity-90 transition" data-share="facebook">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                                <a href="#" class="social-share twitter-bg text-white w-10 h-10 rounded-full flex items-center justify-center hover:opacity-90 transition" data-share="twitter">
                                    <i class="fab fa-twitter"></i>
                                </a>
                                <a href="#" class="social-share linkedin-bg text-white w-10 h-10 rounded-full flex items-center justify-center hover:opacity-90 transition" data-share="linkedin">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                                <a href="#" class="social-share whatsapp-bg text-white w-10 h-10 rounded-full flex items-center justify-center hover:opacity-90 transition" data-share="whatsapp">
                                    <i class="fab fa-whatsapp"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Comments Section -->
<section class="mt-12 border-t border-gray-200 pt-8" data-aos="fade-up">
    <h3 class="text-2xl font-bold text-blue-900 mb-6">{{ comments.count }} Comment{{ comments.count|pluralize }}</h3>
    
    <!-- Display Comments -->
    <div class="space-y-6">
      {% for comment in comments %}
    <div class="border-b border-gray-100 pb-4">
        <p class="font-semibold text-gray-800">{{ comment.name }} 
            <span class="text-gray-500 text-sm">{{ comment.created_date|date:"F d, Y H:i" }}</span>
        </p>
        <p class="text-gray-700 mt-1">{{ comment.content }}</p>
    </div>
{% empty %}
    <p class="text-gray-600">No comments yet. Be the first to comment!</p>
{% endfor %}

    </div>
{% if messages %}
    <div class="mb-6 space-y-2">
        {% for message in messages %}
            <div class="p-4 rounded-lg
                {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
    <!-- Comment Form -->
    <div class="mt-10">
        <h3 class="text-2xl font-bold text-blue-900 mb-4">Leave a Comment</h3>
        <form action="{% url 'blog:add_comment' post.slug %}" method="post" class="space-y-4">
            {% csrf_token %}
            {{ comment_form.non_field_errors }}
            
            <div>
                {{ comment_form.name.errors }}
                {{ comment_form.name }}
            </div>
            <div>
                {{ comment_form.email.errors }}
                {{ comment_form.email }}
            </div>
            <div>
                {{ comment_form.content.errors }}
                {{ comment_form.content }}
            </div>
            
            <button type="submit" class="bg-blue-900 hover:bg-blue-800 text-white font-semibold px-6 py-2 rounded-lg transition">
                Submit Comment
            </button>
        </form>
    </div>
</section>

                        
                        <!-- Author Bio -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <div class="flex items-start">
                                {% if post.author.profile_image and post.author.profile_image.url %}
                                    <img src="{{ post.author.profile_image.url }}" 
                                         alt="{{ post.author.get_full_name|default:post.author.username }}" class="w-16 h-16 rounded-full mr-4">
                                {% else %}
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-900 to-blue-700 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-user text-white text-xl"></i>
                                    </div>
                                {% endif %}
                                <div>
                                    <h3 class="text-xl font-bold text-blue-900 mb-2">About the Author</h3>
                                    <p class="text-gray-700 mb-2">
                                        <strong>{{ post.author.get_full_name|default:post.author.username }}</strong> 
                                        {% if post.author.bio %}
                                            {{ post.author.bio }}
                                        {% else %}
                                            is a Senior Property Consultant at DreamHomes Realty with extensive experience in Nagpur's real estate market.
                                        {% endif %}
                                    </p>
                                    {% if post.author %}
    <a href="{% url 'agents:contact_agent' post.author.id %}" 
       class="text-blue-900 font-semibold hover:text-yellow-600 transition flex items-center">
        Contact {{ post.author.get_full_name|default:"the agent" }}
        <i class="fas fa-arrow-right ml-2"></i>
    </a>
{% endif %}

                                </div>
                            </div>
                        </div>
                    </footer>
                </article>
                
                <!-- Sidebar -->
                <aside class="lg:w-1/3">
                    <div class="sticky-sidebar space-y-8">
                        <!-- About the Author (Mobile) -->
                        <div class="bg-white p-6 rounded-lg shadow-md lg:hidden">
                            <div class="flex items-center mb-4">
                                {% if post.author.profile_image and post.author.profile_image.url %}
                                    <img src="{{ post.author.profile_image.url }}" 
                                         alt="{{ post.author.get_full_name|default:post.author.username }}" class="w-12 h-12 rounded-full mr-4">
                                {% else %}
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-900 to-blue-700 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                {% endif %}
                                <div>
                                    <h3 class="font-bold text-blue-900">{{ post.author.get_full_name|default:post.author.username }}</h3>
                                    <p class="text-gray-600 text-sm">Senior Property Consultant</p>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm mb-4">
                                {% if post.author.bio %}
                                    {{ post.author.bio|truncatewords:20 }}
                                {% else %}
                                    With extensive experience in Nagpur's real estate market, specializes in helping first-time home buyers.
                                {% endif %}
                            </p>
                            <a href="{% url 'contact' %}#contact-form" class="w-full bg-blue-900 hover:bg-blue-800 text-white font-bold py-2 rounded-lg transition text-center block">
                                Contact {{ post.author.get_full_name|default:"Author" }}
                            </a>
                        </div>
                        
                        <!-- Recent Posts -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold text-blue-900 mb-4">Recent Posts</h3>
                            <div class="space-y-4">
                                {% for recent_post in recent_posts %}
                                    <a href="{% url 'blog:blog_detail' recent_post.slug %}" class="recent-post flex border-b border-gray-200 pb-4 last:border-b-0 hover:bg-gray-50 p-2 rounded transition">
                                        {% if recent_post.image and recent_post.image.url %}
                                            <img src="{{ recent_post.image.url }}" 
                                                 alt="{{ recent_post.title }}" class="w-16 h-16 object-cover rounded mr-4">
                                        {% else %}
                                            <div class="w-16 h-16 bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center rounded mr-4">
                                                <i class="fas fa-home text-white text-sm"></i>
                                            </div>
                                        {% endif %}
                                        <div>
                                            <h4 class="font-semibold text-blue-900 text-sm mb-1">{{ recent_post.title|truncatewords:10 }}</h4>
                                            <p class="text-gray-500 text-xs">{{ recent_post.published_date|date:"F d, Y" }}</p>
                                        </div>
                                    </a>
                                {% empty %}
                                    <p class="text-gray-600 text-sm">No recent posts available.</p>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Categories -->
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold text-blue-900 mb-4">Categories</h3>
                            <ul class="space-y-3">
                                {% for category in categories %}
                                    <li>
                                        <a href="{% url 'blog:blog_list' %}?category={{ category.slug }}" 
                                           class="flex justify-between text-gray-700 hover:text-blue-900 transition py-2 border-b border-gray-100 last:border-b-0">
                                            <span>{{ category.name }}</span>
                                            <span class="bg-blue-100 text-blue-900 px-2 py-1 rounded-full text-xs">{{ category.post_count }}</span>
                                        </a>
                                    </li>
                                {% empty %}
                                    <li class="text-gray-500">No categories available.</li>
                                {% endfor %}
                            </ul>
                        </div>
                        
                        <!-- CTA -->
                        <div class="bg-blue-900 text-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold mb-4">Need Help Buying Your First Home?</h3>
                            <p class="mb-4 text-blue-100">Our expert agents specialize in helping first-time buyers navigate the process smoothly.</p>
                            <a href="{% url 'contact' %}#contact-form" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 rounded-lg transition text-center block">
                                Contact Our Team
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </section>

    <!-- Related Articles -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-blue-900 mb-4" data-aos="fade-up">You Might Also Like</h2>
                <p class="text-gray-600 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="200">
                    Explore more articles to help you with your home buying journey.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {% for related_post in related_posts %}
                    <article class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition" data-aos="fade-up" data-aos-delay="{% cycle '0' '100' '200' %}">
                        {% if related_post.image and related_post.image.url %}
                            <img src="{{ related_post.image.url }}" 
                                 alt="{{ related_post.title }}" class="w-full h-48 object-cover">
                        {% else %}
                            <div class="w-full h-48 bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center">
                                <i class="fas fa-home text-white text-4xl"></i>
                            </div>
                        {% endif %}
                        <div class="p-6">
                            <div class="flex items-center text-gray-500 text-sm mb-3">
                                <i class="far fa-calendar-alt mr-2"></i> {{ related_post.published_date|date:"F d, Y" }}
                            </div>
                            {% for category in related_post.categories.all %}
                                <span class="category-badge {{ category.slug }}">{{ category.name }}</span>
                            {% endfor %}
                            <h3 class="text-xl font-bold text-blue-900 mb-3 mt-2">{{ related_post.title }}</h3>
                            <p class="text-gray-600 mb-4">{{ related_post.summary|truncatewords:20 }}</p>
                            <a href="{% url 'blog:blog_detail' related_post.slug %}" class="text-blue-900 font-semibold hover:text-yellow-600 transition flex items-center">
                                Read More <i class="fas fa-arrow-right ml-2"></i>
                            </a>
                        </div>
                    </article>
                {% empty %}
                    <p class="text-gray-600 col-span-3 text-center py-8">No related articles available.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 bg-blue-900 text-white">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6" data-aos="fade-up">Ready to Start Your Home Buying Journey?</h2>
            <p class="text-xl mb-10 max-w-2xl mx-auto text-blue-100" data-aos="fade-up" data-aos-delay="200">
                Contact our expert team today for personalized guidance and support.
            </p>
            <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4" data-aos="fade-up" data-aos-delay="400">
                <a href="{% url 'contact' %}#contact-form" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-8 rounded-lg transition transform hover:scale-105">
                    Contact Our Team
                </a>
                <a href="{% url 'properties:property_list' %}" class="bg-transparent border-2 border-white hover:bg-white hover:text-blue-900 text-white font-bold py-3 px-8 rounded-lg transition transform hover:scale-105">
                    Browse Properties
                </a>
            </div>
        </div>
    </section>
    {% include 'includes/footer.html' %}
{% endblock %}

{% block extra_css %}
<style>
    .category-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background-color: #dbeafe;
        color: #1e40af;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .category-badge.buying-guide { background-color: #dcfce7; color: #166534; }
    .category-badge.selling-tips { background-color: #fef3c7; color: #92400e; }
    .category-badge.market-trends { background-color: #e0e7ff; color: #3730a3; }
    .category-badge.home-improvement { background-color: #fce7f3; color: #be185d; }
    .category-badge.investment { background-color: #fef3c7; color: #92400e; }
    .category-badge.first-time-buyers { background-color: #dcfce7; color: #166534; }
    
    .facebook-bg { background-color: #3b5998; }
    .twitter-bg { background-color: #1da1f2; }
    .linkedin-bg { background-color: #0077b5; }
    .whatsapp-bg { background-color: #25d366; }
    
    .sticky-sidebar {
        position: sticky;
        top: 2rem;
    }
    
    .article-content {
        line-height: 1.7;
    }
    
    .article-content h2 {
        font-size: 1.5rem;
        font-weight: bold;
        color: #1e3a8a;
        margin-top: 2rem;
        margin-bottom: 1rem;
    }
    
    .article-content h3 {
        font-size: 1.25rem;
        font-weight: bold;
        color: #1e40af;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }
    
    .article-content p {
        margin-bottom: 1rem;
    }
    
    .article-content ul, .article-content ol {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
    }
    
    .article-content li {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // Initialize AOS
    document.addEventListener('DOMContentLoaded', function() {
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });
        
        // Social sharing functionality
        document.querySelectorAll('.social-share').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const url = window.location.href;
                const title = document.title;
                
                if (this.dataset.share === 'facebook') {
                    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, 'facebook-share-dialog', 'width=626,height=436');
                } else if (this.dataset.share === 'twitter') {
                    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`, 'twitter-share-dialog', 'width=626,height=436');
                } else if (this.dataset.share === 'linkedin') {
                    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, 'linkedin-share-dialog', 'width=626,height=436');
                } else if (this.dataset.share === 'whatsapp') {
                    window.open(`https://wa.me/?text=${encodeURIComponent(title + ' ' + url)}`, 'whatsapp-share-dialog', 'width=626,height=436');
                }
            });
        });

        // Reading time calculation
        function calculateReadingTime() {
            const article = document.querySelector('.article-content');
            if (article) {
                const text = article.textContent || article.innerText;
                const wordCount = text.trim().split(/\s+/).length;
                const readingTime = Math.ceil(wordCount / 200); // 200 words per minute
                document.querySelector('.reading-time').textContent = `${readingTime} min read`;
            }
        }

        // Initialize when page loads
        calculateReadingTime();
    });
</script>
{% endblock %}