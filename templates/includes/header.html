<!-- Header -->
<header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <!-- Logo -->
        <div class="flex items-center">
            <div class="w-10 h-10 bg-blue-900 rounded-full flex items-center justify-center mr-2">
                <i class="fas fa-home text-white text-lg"></i>
            </div>
            <a href="{% url 'home' %}" class="text-2xl font-bold text-blue-900">
                DreamHomes <span class="text-yellow-600">Realty</span>
            </a>
        </div>
        
        <!-- Desktop Navigation -->
        <nav class="hidden md:flex space-x-8 items-center">
            <a href="{% url 'home' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">Home</a>
            <a href="{% url 'properties:property_list' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">Properties</a>
            <a href="{% url 'agents:agents_list' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">Our Agents</a>
            <a href="{% url 'about' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">About</a>
            <a href="{% url 'blog:blog_list' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">Blog</a>
            <a href="{% url 'contact' %}" class="text-gray-600 font-medium hover:text-yellow-600 transition">Contact</a>
            
            {% if user.is_authenticated %}
                <div class="relative group">
                    <button class="flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-2 transition">
                        <img src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80{% endif %}" 
     alt="User" class="w-8 h-8 rounded-full">

                        <span class="text-gray-700">Welcome, {{ user.first_name|default:user.username }}</span>
                        <i class="fas fa-chevron-down text-gray-600 text-sm"></i>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300">
                        <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                            <i class="fas fa-user mr-2"></i> My Profile
                        </a>
                        <a href="{% url 'settings' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                            <i class="fas fa-cog mr-2"></i> Settings
                        </a>
                        <hr class="my-2">
                        <form action="{% url 'logout' %}" method="post" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="w-full text-left block px-4 py-2 text-gray-700 hover:bg-gray-100 transition">
                                <i class="fas fa-sign-out-alt mr-2"></i> Sign Out
                            </button>
                        </form>
                    </div>
                </div>
            {% else %}
                <a href="{% url 'login' %}" class="text-blue-900 font-medium hover:text-yellow-600 transition">Login</a>
            {% endif %}
        </nav>
        
        <!-- Mobile Menu Button -->
        <div class="flex items-center space-x-4">
            {% if user.is_authenticated %}
                <!-- Mobile User Icon -->
                <div class="md:hidden">
                    <button id="mobile-user-button" class="flex items-center p-2">
                        <img src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80{% endif %}" 
     alt="User" class="w-8 h-8 rounded-full">

                    </button>
                </div>
            {% endif %}
            
            <button id="mobile-menu-button" class="md:hidden text-blue-900 p-2">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
        <div class="container mx-auto px-4 py-4 space-y-4">
            <a href="{% url 'home' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">Home</a>
            <a href="{% url 'properties:property_list' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">Properties</a>
            <a href="{% url 'agents:agents_list' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">Our Agents</a>
            
            <a href="{% url 'blog:blog_list' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">Blog</a>
            <a href="{% url 'contact' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">Contact</a>
            <a href="{% url 'about' %}" class="block py-2 text-gray-600 font-medium hover:text-yellow-600 transition">About</a>
            
            {% if user.is_authenticated %}
                <div class="pt-4 border-t border-gray-200">
                    <p class="text-sm text-gray-500 mb-2">Welcome, {{ user.first_name|default:user.username }}</p>
                    <a href="{% url 'profile' %}" class="block py-2 text-blue-900 font-medium hover:text-yellow-600 transition">My Profile</a>
                    <a href="{% url 'settings' %}" class="block py-2 text-blue-900 font-medium hover:text-yellow-600 transition">Settings</a>
                    <form action="{% url 'logout' %}" method="post" class="block">
                        {% csrf_token %}
                        <button type="submit" class="w-full text-left py-2 text-red-600 font-medium hover:text-red-700 transition">
                            Sign Out
                        </button>
                    </form>
                </div>
            {% else %}
                <div class="pt-4 border-t border-gray-200">
                    <a href="{% url 'login' %}" class="block py-2 text-blue-900 font-medium hover:text-yellow-600 transition">Login</a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Mobile User Menu -->
    {% if user.is_authenticated %}
    <div id="mobile-user-menu" class="hidden md:hidden bg-white border-t border-gray-200">
        <div class="container mx-auto px-4 py-4 space-y-3">
            <p class="text-sm text-gray-500">Welcome, {{ user.first_name|default:user.username }}</p>
            <a href="{% url 'profile' %}" class="block py-2 text-blue-900 font-medium hover:text-yellow-600 transition">My Profile</a>
            <a href="{% url 'settings' %}" class="block py-2 text-blue-900 font-medium hover:text-yellow-600 transition">Settings</a>
            <form action="{% url 'logout' %}" method="post" class="block">
                {% csrf_token %}
                <button type="submit" class="w-full text-left py-2 text-red-600 font-medium hover:text-red-700 transition">
                    Sign Out
                </button>
            </form>
        </div>
    </div>
    {% endif %}
</header>

<!-- JavaScript for Mobile Menu -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded - initializing mobile menu');
    
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileUserButton = document.getElementById('mobile-user-button');
    const mobileUserMenu = document.getElementById('mobile-user-menu');

    // Debug logging
    console.log('Mobile menu button:', mobileMenuButton);
    console.log('Mobile menu:', mobileMenu);
    console.log('Mobile user button:', mobileUserButton);
    console.log('Mobile user menu:', mobileUserMenu);

    // Mobile menu toggle
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function(e) {
            console.log('Mobile menu button clicked');
            e.stopPropagation();
            mobileMenu.classList.toggle('hidden');
            
            // Close user menu if open
            if (mobileUserMenu) {
                mobileUserMenu.classList.add('hidden');
            }
        });
    } else {
        console.log('Mobile menu elements not found');
    }

    // Mobile user menu toggle
    if (mobileUserButton && mobileUserMenu) {
        mobileUserButton.addEventListener('click', function(e) {
            console.log('Mobile user button clicked');
            e.stopPropagation();
            mobileUserMenu.classList.toggle('hidden');
            
            // Close main menu if open
            if (mobileMenu) {
                mobileMenu.classList.add('hidden');
            }
        });
    }

    // Close menus when clicking outside
    document.addEventListener('click', function(event) {
        console.log('Document clicked');
        
        // Close mobile menu if clicking outside
        if (mobileMenu && !mobileMenu.contains(event.target) && mobileMenuButton && !mobileMenuButton.contains(event.target)) {
            console.log('Closing mobile menu');
            mobileMenu.classList.add('hidden');
        }
        
        // Close mobile user menu if clicking outside
        if (mobileUserMenu && !mobileUserMenu.contains(event.target) && mobileUserButton && !mobileUserButton.contains(event.target)) {
            console.log('Closing mobile user menu');
            mobileUserMenu.classList.add('hidden');
        }
    });

    // Close menus when pressing Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            console.log('Escape pressed - closing menus');
            if (mobileMenu) mobileMenu.classList.add('hidden');
            if (mobileUserMenu) mobileUserMenu.classList.add('hidden');
        }
    });

    // Close menus when navigating
    const menuLinks = document.querySelectorAll('#mobile-menu a, #mobile-user-menu a');
    menuLinks.forEach(link => {
        link.addEventListener('click', function() {
            console.log('Menu link clicked - closing menus');
            if (mobileMenu) mobileMenu.classList.add('hidden');
            if (mobileUserMenu) mobileUserMenu.classList.add('hidden');
        });
    });

    // Prevent menu buttons from closing their own menus
    if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
    
    if (mobileUserButton) {
        mobileUserButton.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }
});
</script>

<!-- Alternative Simple JavaScript (if above doesn't work) -->
<script>
// Simple alternative approach
function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    
    if (menuButton && menu) {
        menuButton.onclick = function() {
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
            }
        };
        
        // Close menu when clicking anywhere else
        document.addEventListener('click', function(e) {
            if (!menu.contains(e.target) && !menuButton.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
    }
}

// Initialize when page loads
window.addEventListener('load', initMobileMenu);
</script>

<style>
    /* Smooth transitions for dropdown */
    .group:hover .group-hover\:opacity-100 {
        opacity: 1;
    }
    
    .group:hover .group-hover\:visible {
        visibility: visible;
    }
    
    /* Ensure dropdown stays on top */
    .z-50 {
        z-index: 50;
    }
    
    /* Make mobile menu button more clickable */
    #mobile-menu-button, #mobile-user-button {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    #mobile-menu-button:hover, #mobile-user-button:hover {
        transform: scale(1.1);
    }
</style>
